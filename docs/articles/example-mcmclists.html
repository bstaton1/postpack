<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example mcmc.lists • postpack</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example mcmc.lists">
<meta property="og:description" content="postpack">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">postpack</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fas fa fas fa-book fa-lg"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-file fa-lg"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/feature-overview.html">Feature Overview</a>
    </li>
    <li>
      <a href="../articles/pattern-matching.html">Pattern Matching</a>
    </li>
    <li>
      <a href="../articles/multiple-models.html">Multiple Models</a>
    </li>
    <li>
      <a href="../articles/example-mcmclists.html">Example mcmc.lists</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">
    <span class="fas fa fas fa-newspaper fa-lg"></span>
     
    Changelog
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bstaton1/postpack/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="example-mcmclists_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example mcmc.lists</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bstaton1/postpack/blob/master/vignettes/example-mcmclists.Rmd"><code>vignettes/example-mcmclists.Rmd</code></a></small>
      <div class="hidden name"><code>example-mcmclists.Rmd</code></div>

    </div>

    
    
<p>‘postpack’ ships with two example <code>mcmc.list</code> objects to allow self-contained examples and for users to practice using ‘postpack’. The <code>mcmc.list</code> objects can be loaded using:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">cjs</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">cjs_no_rho</span>)</pre></body></html></div>
<p>Both objects come from a JAGS model fitted to simulated data. The two objects are from two separate, but highly similar models. The output was thinned heavily to reduce file size, see:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="kw pkg">postpack</span><span class="kw ns">::</span><span class="fu"><a href="../reference/post_dim.html">post_dim</a></span>(<span class="no">cjs</span>)</pre></body></html></div>
<pre><code>##      burn post_burn      thin    chains     saved    params 
##     11000     50000       200         2       500        21</code></pre>
<p>Each of two chains was ran for 61,000 iterations – 11,000 were adapting/burn-in phase and 50,000 were after burn-in. Chains were thinned at an interval of 200 iterations, resulting in 500 total saved samples per 21 parameters (elements in the model).</p>
<div id="the-context" class="section level1">
<h1 class="hasAnchor">
<a href="#the-context" class="anchor"></a>The Context</h1>
<p>Posterior samples were generated from a model fitted to a hypothetical (i.e., simulated) data set. Suppose for 5 years, biologists individually tagged juvenile salmon in the headwaters of a river system before the fish made their migration out to sea. The length of each fish was measured as well, and it is safe to assume tagged fish are a random sample from the larger population and that they were all released at the same time within a given year.</p>
<p>Three receiver arrays exist in the river that can detect fish as they move past them, but they are imperfect (sometimes a receiver will not detect a tagged fish passing it). The principle research goal is to quantify whether survival during migration is associated with fish size.</p>
<p>Known quantities necessary for fitting the model (see below) include:</p>
<ul>
<li>
<code>nt</code>: number of years</li>
<li>
<code>year</code>: year indicator variable</li>
<li>
<code>J</code>: number of times each fish can be detected, including tagging event</li>
<li>
<code>N</code>: number of fish tagged in the study (across all years)</li>
<li>
<code>y</code>: detection history matrix (<code>N</code> by <code>J</code>); 1 if fish seen that event, 0 if not.</li>
</ul>
</div>
<div id="the-model" class="section level1">
<h1 class="hasAnchor">
<a href="#the-model" class="anchor"></a>The Model</h1>
<p>The model is a Cormack-Jolly-Seber survival model. It estimates survival and detection probabilities based on individually-identifiable tagged fish. Based on how often a fish is not seen at a location and then seen at a later location, it is possible to estimate detection probabilities. Then, based on how often a fish is never seen again, it is possible to estimate survival probabilities<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
<p>This is a state-space formulation, where there are explicit random processes for both the true state of each fish (alive or dead) and the observed state of each fish (detected or not detected) in each event. Both are Bernoulli random variables, with <code>z</code> representing the true state (0 = dead; 1 = alive) and <code>y</code> representing the observed state (0 = not detected; 1 = detected). It is assumed that fish cannot be detected if they are dead. Survival probability between two consecutive detection events for fish <code>i</code> is denoted by <code>phi[i]</code> and for this model is expressed as a logit-linear function of fish size (<code>FL[i]</code>, scaled and centered prior to model fitting), with random slopes and intercepts for each year. Detection probability for this model is assumed to vary among detection arrays, but is constant across years for a given array.</p>
<p>Here is the JAGS code for this model:</p>
<pre><code>model{
  # HYPERPARAMETERS: SURVIVAL COEFFICIENTS AND VARIABILITY
  B0 ~ dnorm(0, 0.001)
  B1 ~ dnorm(0, 0.001)
  sig_B0 ~ dunif(0,10)
  sig_B1 ~ dunif(0,10)
  rho ~ dunif(-1,1)
  
  # COVARIANCE MATRIX FOR YEAR-SPECIFIC SURVIVAL COEFFICIENTS
  SIG[1,1] &lt;- sig_B0^2
  SIG[2,2] &lt;- sig_B1^2
  SIG[2,1] &lt;- sig_B0 * sig_B1 * rho
  SIG[1,2] &lt;- sig_B0 * sig_B1 * rho
  
  # YEAR-SPECIFIC SURVIVAL COEFFICIENTS
  Bmean[1] &lt;- B0
  Bmean[2] &lt;- B1
  for (t in 1:nt) {
    b[t,1:2] ~ dmnorm.vcov(Bmean[1:2], SIG[1:2,1:2])
    b0[t] &lt;- b[t,1]
    b1[t] &lt;- b[t,2]
  }
  
  # DETECTION PROBABILITY: OCCASION-SPECIFIC, BUT YEAR-CONSTANT
  for (j in 2:J) {
    p[j] ~ dunif(0,1)
  }
  
  # LIKELIHOOD
  for (i in 1:N) {
    # obtain fish-specific survival based on size
    logit(phi[i]) &lt;- b0[year[i]] + b1[year[i]] * FL[i]
    for (j in 2:J) {
      # latent survival process:
      # must have been alive last period to be alive this period
      z[i,j] ~ dbern(z[i,j-1] * phi[i])
      
      # observation process:
      # must be alive this period to be detected this period
      y[i,j] ~ dbern(z[i,j] * p[j])
    }
  }
}</code></pre>
<p><strong>Parameter definitions</strong>:</p>
<ul>
<li>
<code>B0</code>: intercept of logit-linear survival vs. length relationship: global mean across years</li>
<li>
<code>B1</code>: slope of logit-linear survival v. length relationship: global mean across years</li>
<li>
<code>b0[1:5]</code>: year-specific survival random intercepts</li>
<li>
<code>b1[1:5]</code>: year-specific survival random slopes</li>
<li>
<code>sig_B0</code>: standard deviation of year-specific intercepts</li>
<li>
<code>sig_B1</code>: standard deviation of year-specific slopes</li>
<li>
<code>rho</code>: correlation between random intercepts and slopes</li>
<li>
<code>SIG[1:2,1:2]</code>: variance-covariance matrix modeling the covariance between random slopes and intercepts</li>
<li>
<code>p[2:4]</code>: detection probability for each receiver array, assumed constant across years (note the first detection occasion is not modeled because that is the tagging event – all fish were alive and detected)</li>
</ul>
<p>The <code>mcmc.list</code> object accessed via <code><a href="https://rdrr.io/r/utils/data.html">data(cjs)</a></code> is from this model exactly, the one found in <code><a href="https://rdrr.io/r/utils/data.html">data(cjs_no_rho)</a></code> is from the same model, but with the <code>rho</code> parameter fixed at zero rather than estimating its value.</p>
<p>The nodes that were monitored include:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="kw pkg">postpack</span><span class="kw ns">::</span><span class="fu"><a href="../reference/get_params.html">get_params</a></span>(<span class="no">cjs</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"base_index"</span>)</pre></body></html></div>
<pre><code>##  [1] "B0"       "sig_B0"   "B1"       "sig_B1"   "b0[1]"    "b0[2]"   
##  [7] "b0[3]"    "b0[4]"    "b0[5]"    "b1[1]"    "b1[2]"    "b1[3]"   
## [13] "b1[4]"    "b1[5]"    "SIG[1,1]" "SIG[2,1]" "SIG[1,2]" "SIG[2,2]"
## [19] "p[2]"     "p[3]"     "p[4]"</code></pre>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Readers interested in this kind of model are encouraged to refer to <em>Bayesian Population Analysis using WinBUGS: A Hierarchical Perspective</em> by Marc Kéry and Michael Schuab.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ben Staton.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
