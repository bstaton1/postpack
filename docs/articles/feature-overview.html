<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Feature Overview • postpack</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Feature Overview">
<meta property="og:description" content="postpack">
<meta property="og:image" content="https://raw.githubusercontent.com/bstaton1/postpack/master/man/figures/postpack-social-media-image.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@bstat0n">
<meta name="twitter:site" content="@bstat0n">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">postpack</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fas fa-book fa-lg"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-file fa-lg"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/feature-overview.html">Feature Overview</a>
    </li>
    <li>
      <a href="../articles/pattern-matching.html">Pattern Matching</a>
    </li>
    <li>
      <a href="../articles/multiple-models.html">Multiple Models</a>
    </li>
    <li>
      <a href="../articles/example-mcmclists.html">Example mcmc.lists</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">
    <span class="fas fa-newspaper fa-lg"></span>
     
    Changelog
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bstaton1/postpack/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="feature-overview_files/header-attrs-2.6.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Feature Overview</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bstaton1/postpack/blob/master/vignettes/feature-overview.Rmd"><code>vignettes/feature-overview.Rmd</code></a></small>
      <div class="hidden name"><code>feature-overview.Rmd</code></div>

    </div>

    
    
<p>This vignette is intended to get you up and running using ‘postpack’ to process your MCMC output by showcasing some of the main features.</p>
<div id="prequisites" class="section level1">
<h1 class="hasAnchor">
<a href="#prequisites" class="anchor"></a>Prequisites</h1>
<p>‘postpack’ requires that your MCMC samples are stored in <code>mcmc.list</code> objects (class and methods supplied by the ‘coda’ package). MCMC samples should be produced from at least two chains – single chain output has not been tested with ‘postpack’ functions. Some MCMC interfaces produce this output by default, while others require an extra step to convert to <code>mcmc.list</code>.</p>
<p><strong>JAGS</strong></p>
<p><code>mcmc.list</code> output is returned by:</p>
<ul>
<li><code><a href="https://rdrr.io/pkg/rjags/man/coda.samples.html">rjags::coda.samples()</a></code></li>
<li><code><a href="https://rdrr.io/pkg/jagsUI/man/jagsbasic.html">jagsUI::jags.basic()</a></code></li>
<li>The <code>$samples</code> element of <code><a href="https://rdrr.io/pkg/jagsUI/man/jags.html">jagsUI::jags()</a></code>
</li>
</ul>
<p><strong>NIMBLE</strong></p>
<p>To obtain <code>mcmc.list</code> output, users should set the <code>samplesAsCodaMCMC = TRUE</code> argument when calling <code><a href="https://rdrr.io/pkg/nimble/man/runMCMC.html">nimble::runMCMC()</a></code>.</p>
<p><strong>Stan</strong></p>
<p>The output of <code><a href="https://mc-stan.org/rstan/reference/stan.html">rstan::stan()</a></code> can be converted to <code>mcmc.list</code> format using <code><a href="https://mc-stan.org/rstan/reference/As.mcmc.list.html">rstan::As.mcmc.list()</a></code>.</p>
<p><strong>WinBUGS/OpenBUGS</strong></p>
<p>The output of both:</p>
<ul>
<li><code><a href="https://rdrr.io/pkg/R2WinBUGS/man/bugs.html">R2WinBUGS::bugs()</a></code></li>
<li><code><a href="https://rdrr.io/pkg/R2OpenBUGS/man/bugs.html">R2OpenBUGS::bugs()</a></code></li>
</ul>
<p>can be converted to <code>mcmc.list</code> format using <code><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html">coda::as.mcmc.list()</a></code> or <code><a href="../reference/post_convert.html">postpack::post_convert()</a></code>.</p>
<p>If your samples were generated another way (e.g., a custom MCMC algorithm or a package like ‘MCMCpack’), check out <code><a href="../reference/post_convert.html">?postpack::post_convert</a></code> to see how you may be able to reformat them.</p>
</div>
<div id="getting-started" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting Started</h1>
<p>This vignette uses an example <code>mcmc.list</code> object called <code>cjs</code> to illustrate the main features of ‘postpack’, see <code><a href="../reference/cjs.html">?cjs</a></code> or <code><a href="../articles/example-mcmclists.html">vignette("example-mcmclists")</a></code> for more details. To follow along, load it and ‘postpack’ into your session:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">postpack</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">cjs</span>)</pre></body></html></div>
</div>
<div id="query-mcmc-attributes" class="section level1">
<h1 class="hasAnchor">
<a href="#query-mcmc-attributes" class="anchor"></a>Query MCMC Attributes</h1>
<p>You can return the dimensions of the MCMC run using:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="../reference/post_dim.html">post_dim</a></span>(<span class="no">cjs</span>)</pre></body></html></div>
<pre><code>##      burn post_burn      thin    chains     saved    params 
##     11000     50000       200         2       500        21</code></pre>
<p>These elements should be self-explanatory, but see <code><a href="../reference/post_dim.html">?post_dim</a></code> for details. You can extract one of these dimensional elements quickly by specifying the <code>types</code> argument, e.g., notice that there are 21 saved nodes by running <code><a href="../reference/post_dim.html">post_dim(cjs, types = "params")</a></code>.</p>
<p>The parameter names of these nodes will be crucial in subsetting them, so you should be able to check them out quickly at any time. This is the purpose of the <code><a href="../reference/get_params.html">get_params()</a></code> function:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="../reference/get_params.html">get_params</a></span>(<span class="no">cjs</span>)</pre></body></html></div>
<pre><code>## [1] "B0"     "sig_B0" "B1"     "sig_B1" "b0"     "b1"     "SIG"    "p"</code></pre>
<p>This shows you the base node names that were monitored during model fitting. If you wish to see the element indices associated with each node as well, supply the <code>type = "base_index"</code> argument:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="../reference/get_params.html">get_params</a></span>(<span class="no">cjs</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"base_index"</span>)</pre></body></html></div>
<pre><code>##  [1] "B0"       "sig_B0"   "B1"       "sig_B1"   "b0[1]"    "b0[2]"   
##  [7] "b0[3]"    "b0[4]"    "b0[5]"    "b1[1]"    "b1[2]"    "b1[3]"   
## [13] "b1[4]"    "b1[5]"    "SIG[1,1]" "SIG[2,1]" "SIG[1,2]" "SIG[2,2]"
## [19] "p[2]"     "p[3]"     "p[4]"</code></pre>
</div>
<div id="extracting-posterior-summaries" class="section level1">
<h1 class="hasAnchor">
<a href="#extracting-posterior-summaries" class="anchor"></a>Extracting Posterior Summaries</h1>
<p>A cornerstone of ‘postpack’ is the <code><a href="../reference/post_summ.html">post_summ()</a></code> function, which is for extracting posterior summaries for particular nodes of interest.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="../reference/post_summ.html">post_summ</a></span>(<span class="no">cjs</span>, <span class="kw">params</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"sig_B0"</span>, <span class="st">"sig_B1"</span>))</pre></body></html></div>
<pre><code>##          sig_B0      sig_B1
## mean  0.8440230 0.243479572
## sd    0.6187583 0.262166509
## 50%   0.6820298 0.178356796
## 2.5%  0.2766108 0.005735707
## 97.5% 2.4394721 0.820640886</code></pre>
<p>The output is in a simple, easily subsettable matrix format (unlike <code><a href="https://rdrr.io/pkg/coda/man/summary.mcmc.html">coda::summary.mcmc()</a></code>), which makes plotting these summaries more straight-forward. Presented by default are posterior mean, standard deviation, and the 50%, 2.5%, and 97.5% quantiles. You can report other quantiles using <code>probs</code> if desired and round them using <code>digits</code>:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="../reference/post_summ.html">post_summ</a></span>(<span class="no">cjs</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"sig_B0"</span>, <span class="st">"sig_B1"</span>), <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">probs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.025</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.975</span>))</pre></body></html></div>
<pre><code>##       sig_B0 sig_B1
## mean   0.844  0.243
## sd     0.619  0.262
## 2.5%   0.277  0.006
## 25%    0.490  0.081
## 50%    0.682  0.178
## 75%    1.035  0.319
## 97.5%  2.439  0.821</code></pre>
<p>One of the key features is that the <code>params</code> argument selects nodes based on regular expressions, so all elements of the <code>"b0"</code> node can be summarized with:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="../reference/post_summ.html">post_summ</a></span>(<span class="no">cjs</span>, <span class="st">"b0"</span>)</pre></body></html></div>
<pre><code>##           b0[1]     b0[2]    b0[3]     b0[4]     b0[5]
## mean  1.3753033 2.3192679 1.751486 1.5200421 1.0824184
## sd    0.2067011 0.3564031 0.238889 0.2032504 0.2077227
## 50%   1.3674581 2.2779459 1.728931 1.5075479 1.0754654
## 2.5%  0.9614656 1.7836702 1.324638 1.1597562 0.6748646
## 97.5% 1.8053107 3.1633955 2.287703 1.9605019 1.5194312</code></pre>
<p>Several ‘postpack’ functions accept the <code>params</code> argument (always in the second argument if it is present) to specify queries from the <code>mcmc.list</code> passed to <code>post</code>, so learning to use it is key. More information on using regular expressions to extract particular nodes can be found in <code><a href="../articles/pattern-matching.html">vignette("pattern-matching")</a></code>.</p>
<p>Estimates of the uncertainty associated with MCMC sampling in the mean and quantiles can be obtained using the <code>mcse</code> argument (which calls <code><a href="https://rdrr.io/pkg/mcmcse/man/mcse.html">mcmcse::mcse()</a></code> and <code><a href="https://rdrr.io/pkg/mcmcse/man/mcse.q.html">mcmcse::mcse.q()</a></code>):</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="../reference/post_summ.html">post_summ</a></span>(<span class="no">cjs</span>, <span class="st">"^B"</span>, <span class="kw">mcse</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>##                    B0          B1
## mean       1.59031238 0.415103100
## sd         0.49113008 0.212836348
## 50%        1.56878458 0.397436350
## 2.5%       0.55133227 0.061825217
## 97.5%      2.58753866 0.863829917
## mcse_mean  0.01359695 0.011192343
## mcse_50%   0.01724213 0.009013355
## mcse_2.5%  0.18139264 0.025923187
## mcse_97.5% 0.06398231 0.042813775</code></pre>
<p>Summaries for each chain can be obtained using the <code>by_chain = TRUE</code> argument:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="../reference/post_summ.html">post_summ</a></span>(<span class="no">cjs</span>, <span class="st">"^B"</span>, <span class="kw">by_chain</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>## , , chain1
## 
##              B0        B1
## mean  1.5571300 0.4180811
## sd    0.4614706 0.2401460
## 50%   1.5502780 0.3988950
## 2.5%  0.5012706 0.0608274
## 97.5% 2.5107643 0.8543241
## 
## , , chain2
## 
##              B0         B1
## mean  1.6234948 0.41212506
## sd    0.5178997 0.18191380
## 50%   1.5922041 0.39674020
## 2.5%  0.5687639 0.07524337
## 97.5% 2.6084912 0.87875912</code></pre>
</div>
<div id="extracting-mcmc-diagnostics" class="section level1">
<h1 class="hasAnchor">
<a href="#extracting-mcmc-diagnostics" class="anchor"></a>Extracting MCMC Diagnostics</h1>
<p>‘postpack’ features two primary ways of diagnosing the convergence/adequate sample behavior of MCMC chains: numerically and visually. Both methods use the <code>params</code> argument to allow users to have control over which nodes get diagnostics.</p>
<p><code><a href="../reference/post_summ.html">post_summ()</a></code> includes two additional arguments for obtaining numerical diagnostics:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="../reference/post_summ.html">post_summ</a></span>(<span class="no">cjs</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"sig_B0"</span>, <span class="st">"sig_B1"</span>), <span class="kw">neff</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">Rhat</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>##            sig_B0       sig_B1
## mean    0.8440230 2.434796e-01
## sd      0.6187583 2.621665e-01
## 50%     0.6820298 1.783568e-01
## 2.5%    0.2766108 5.735707e-03
## 97.5%   2.4394721 8.206409e-01
## Rhat    1.0220000 1.043000e+00
## neff  500.0000000 4.320000e+02</code></pre>
<p><code>neff = TRUE</code> triggers a call to <code><a href="https://rdrr.io/pkg/coda/man/effectiveSize.html">coda::effectiveSize()</a></code> to estimate the number of MCMC samples that are independent and <code>Rhat = TRUE</code> triggers a call to <code><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html">coda::gelman.diag()</a></code> to calculate the commonly used Rhat convergence diagnostic (numbers near 1 are ideal, greater than 1.1 may be problematic). <code>"Rhat"</code> will always be rounded to three digits, and <code>"neff"</code> will always be rounded to an integer, regardless of the value of the <code>digits</code> argument.</p>
<p>Viewing the density and trace plot for a parameter is another common way to evaluate algorithm convergence. The <code><a href="../reference/diag_plots.html">diag_plots()</a></code> function serves this purpose (which, unlike <code>coda:::plot.mcmc()</code>, allows plotting the densities color coded by chain and only for specific nodes):</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="../reference/diag_plots.html">diag_plots</a></span>(<span class="no">cjs</span>, <span class="kw">params</span> <span class="kw">=</span> <span class="st">"SIG"</span>)</pre></body></html></div>
<p><img src="feature-overview_files/figure-html/unnamed-chunk-12-1.png" width="384" style="display: block; margin: auto;"></p>
<p>Options exist to:</p>
<ul>
<li>Display the Rhat and effective MCMC samples for each node (the <code>show_diags</code> argument, which accepts value of <code>"always"</code>, <code>"never"</code>, or <code>"if_poor_Rhat"</code> with the last one being the default. See <code><a href="../reference/diag_plots.html">?diag_plots</a></code> for details).</li>
<li>Plot the output in a new external device (the <code>ext_device</code> argument).</li>
<li>Change the size of the graphics device (the <code>dims</code> argument).</li>
<li>Change the layout of parameters on the device (the <code>layout</code> argument).</li>
<li>Save the output to a PDF graphics device (the <code>save</code> argument, which then requires that you enter the <code>file</code> argument, which is the file name of the PDF complete with the <code>".pdf"</code> extension).</li>
<li>Thin the chains by some percentage (at quasi-evenly spaced intervals) before drawing the trace plot – this can help manage the file size when generating many plots with many samples while still providing much of the same inference as the unthinned output. The argument <code>keep_percent = 0.8</code> is passed to <code><a href="../reference/post_thin.html">post_thin()</a></code>, and would discard 20% of the samples prior to trace plotting. This thinning does not affect the density plot visual – all retained samples are plotted there.</li>
</ul>
<p>The <code>dims</code> and <code>layout</code> arguments are set to <code>"auto"</code> by default – for adjustment of these settings, see <code><a href="../reference/diag_plots.html">?diag_plots</a></code>.</p>
<p>The more chains there are in the <code>mcmc.list</code> object passed to the <code>post</code> argument, the more colors will be displayed.</p>
</div>
<div id="extracting-posterior-samples" class="section level1">
<h1 class="hasAnchor">
<a href="#extracting-posterior-samples" class="anchor"></a>Extracting Posterior Samples</h1>
<p>Often you will want to take a subset out of your output while retaining each saved posterior sample, for example, to plot a histogram of the samples or to calculate the posterior of some derived quantity as though it had been included as part of the model code.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">b0_samps</span> <span class="kw">=</span> <span class="fu"><a href="../reference/post_subset.html">post_subset</a></span>(<span class="no">cjs</span>, <span class="st">"b0"</span>)</pre></body></html></div>
<p>By default, the output will be a <code>mcmc.list</code> which allows it to play nicely with the rest of the ‘postpack’ functions (e.g., <code><a href="../reference/get_params.html">get_params(b0_samps)</a></code>). However, performing plotting or calculation tasks on posterior samples might be easier if they were combined across chains and stored as a matrix (nodes as columns, rows as samples):</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">b0_samps</span> <span class="kw">=</span> <span class="fu"><a href="../reference/post_subset.html">post_subset</a></span>(<span class="no">cjs</span>, <span class="st">"b0"</span>, <span class="kw">matrix</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p>Note that if you wish to retain the chain and iteration number of each posterior sample when converting to a matrix with <code><a href="../reference/post_subset.html">post_subset()</a></code>, you can pass the optional logical arguments <code>chains</code> and <code>iters</code> (both are <code>FALSE</code> by default).</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="../reference/post_subset.html">post_subset</a></span>(<span class="no">cjs</span>, <span class="st">"b0"</span>, <span class="kw">matrix</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">chains</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">iters</span> <span class="kw">=</span> <span class="fl">TRUE</span>))</pre></body></html></div>
<pre><code>##      CHAIN  ITER    b0[1]    b0[2]    b0[3]    b0[4]     b0[5]
## [1,]     1 11200 1.275155 2.632859 1.860819 1.708103 0.8804635
## [2,]     1 11400 1.308511 2.077802 1.518087 1.198710 0.9843441
## [3,]     1 11600 1.338846 2.473211 1.358235 1.156759 0.8060235
## [4,]     1 11800 1.654078 2.703028 1.498338 1.279799 1.0339362
## [5,]     1 12000 1.118555 2.313318 1.819527 1.189711 0.9702624
## [6,]     1 12200 1.188926 2.653793 1.633183 1.539144 0.8438322</code></pre>
<p>In some cases, it may be easier to keep all nodes <strong>except</strong> those matched by <code>params</code>. For this this, you can use <code><a href="../reference/post_remove.html">post_remove()</a></code> (if <code>ask = TRUE</code>, you will be prompted to verify that you wish to remove the nodes that were matched – this is the default):</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="co"># check out param names</span>
<span class="fu"><a href="../reference/get_params.html">get_params</a></span>(<span class="no">cjs</span>)</pre></body></html></div>
<pre><code>## [1] "B0"     "sig_B0" "B1"     "sig_B1" "b0"     "b1"     "SIG"    "p"</code></pre>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="co"># remove all SIG nodes</span>
<span class="no">cjs2</span> <span class="kw">=</span> <span class="fu"><a href="../reference/post_remove.html">post_remove</a></span>(<span class="no">cjs</span>, <span class="st">"SIG"</span>, <span class="kw">ask</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="co"># did it work?</span>
<span class="fu"><a href="../reference/get_params.html">get_params</a></span>(<span class="no">cjs2</span>)</pre></body></html></div>
<pre><code>## [1] "B0"     "sig_B0" "B1"     "sig_B1" "b0"     "b1"     "p"</code></pre>
</div>
<div id="matrixarray-nodes" class="section level1">
<h1 class="hasAnchor">
<a href="#matrixarray-nodes" class="anchor"></a>Matrix/Array Nodes</h1>
<div id="array_format" class="section level2">
<h2 class="hasAnchor">
<a href="#array_format" class="anchor"></a><code>array_format()</code>
</h2>
<p>Notice that the <code>"SIG"</code> node is a matrix (there are two dimensions of element indices in the node names):</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r">(<span class="no">SIG_ests</span> <span class="kw">=</span> <span class="fu"><a href="../reference/post_summ.html">post_summ</a></span>(<span class="no">cjs</span>, <span class="st">"SIG"</span>, <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">2</span>))</pre></body></html></div>
<pre><code>##       SIG[1,1] SIG[2,1] SIG[1,2] SIG[2,2]
## mean      1.09     0.05     0.05     0.13
## sd        3.19     0.26     0.26     0.45
## 50%       0.47     0.02     0.02     0.03
## 2.5%      0.08    -0.33    -0.33     0.00
## 97.5%     5.95     0.58     0.58     0.67</code></pre>
<p>You may want to create a matrix that stores the posterior means (or any other summary statistic) in the same format as they would be found in the model. For this, you can use <code><a href="../reference/array_format.html">array_format()</a></code>:</p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="fu"><a href="../reference/array_format.html">array_format</a></span>(<span class="no">SIG_ests</span>[<span class="st">"mean"</span>,])</pre></body></html></div>
<pre><code>##      [,1] [,2]
## [1,] 1.09 0.05
## [2,] 0.05 0.13</code></pre>
<p>Although this is a basic example, this function becomes more useful for higher dimensional nodes – dimensions between 2 and 10 are currently supported.</p>
<p><code><a href="../reference/array_format.html">array_format()</a></code> requires a vector of named elements, where the element names contain the correct indices to place them in (e.g., <code>"SIG[1,1]"</code> and <code>"SIG[2,2]"</code>). Based on the indices in the element names, <code><a href="../reference/array_format.html">array_format()</a></code> determines the dimensions of the object in the model and places the elements in the correct location.</p>
<p><code><a href="../reference/array_format.html">array_format()</a></code> will respect missing values. As an example, suppose the the model did not specify what <code>"SIG[2,1]"</code> should be. In this case, it will not be returned as a tracked node element in the <code>mcmc.list</code> (at least in JAGS). We can simulate this behavior by removing that node from the output, and seeing that <code><a href="../reference/array_format.html">array_format()</a></code> inserts an <code>NA</code> in the proper location:</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="no">cjs2</span> <span class="kw">=</span> <span class="fu"><a href="../reference/post_remove.html">post_remove</a></span>(<span class="no">cjs</span>, <span class="st">"SIG[2,1]"</span>, <span class="kw">ask</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="fu"><a href="../reference/array_format.html">array_format</a></span>(<span class="fu"><a href="../reference/post_summ.html">post_summ</a></span>(<span class="no">cjs2</span>, <span class="st">"SIG"</span>)[<span class="st">"mean"</span>,])</pre></body></html></div>
<pre><code>##          [,1]       [,2]
## [1,] 1.094471 0.04547222
## [2,]       NA 0.12787612</code></pre>
</div>
<div id="vcov_decomp" class="section level2">
<h2 class="hasAnchor">
<a href="#vcov_decomp" class="anchor"></a><code>vcov_decomp()</code>
</h2>
<p>The <code>"SIG"</code> node represents a variance-covariance matrix in the model. Sometimes it is desirable to decompose this matrix into a vector of standard deviations and a correlation matrix. Rather than perform this calculation on the posterior summary of <code>"SIG"</code>, we can perform it for each posterior sample to obtain a posterior of the correlation matrix. This is the purpose of <code><a href="../reference/vcov_decomp.html">vcov_decomp()</a></code>:</p>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="no">SIG_decomp</span> <span class="kw">=</span> <span class="fu"><a href="../reference/vcov_decomp.html">vcov_decomp</a></span>(<span class="no">cjs</span>, <span class="kw">param</span> <span class="kw">=</span> <span class="st">"SIG"</span>)</pre></body></html></div>
<pre><code>## Decomposing variance-covariance matrix node: SIG (2x2)
## 
## </code></pre>
<p>Note the characteristics of the output obtained:</p>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="no">SIG_decomp</span>)</pre></body></html></div>
<pre><code>## [1] "mcmc.list"</code></pre>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="fu"><a href="../reference/post_dim.html">post_dim</a></span>(<span class="no">cjs</span>) <span class="kw">==</span> <span class="fu"><a href="../reference/post_dim.html">post_dim</a></span>(<span class="no">SIG_decomp</span>)</pre></body></html></div>
<pre><code>##      burn post_burn      thin    chains     saved    params 
##      TRUE      TRUE      TRUE      TRUE      TRUE     FALSE</code></pre>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="fu"><a href="../reference/get_params.html">get_params</a></span>(<span class="no">SIG_decomp</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"base_index"</span>)</pre></body></html></div>
<pre><code>## [1] "sigma[1]" "sigma[2]" "rho[1,1]" "rho[2,1]" "rho[1,2]" "rho[2,2]"</code></pre>
<p>The nodes <code>"sigma[1]"</code> and <code>"sigma[2]"</code> represent the square root of the diagonal elements <code>"SIG[1,1]"</code> and <code>"SIG[2,2]"</code> (and are thus the same as the <code>"sig_B0"</code> and <code>"sig_B1"</code> nodes stored in <code>cjs</code>), and the <code>"rho"</code> elements represent to correlation matrix – and posterior samples exist now for each. The names used for these newly-created nodes can be changed using the <code>sigma_base_name</code> and <code>rho_base_name</code> arguments.</p>
<p>You can now build the posterior median correlation matrix:</p>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="fu"><a href="../reference/array_format.html">array_format</a></span>(<span class="fu"><a href="../reference/post_summ.html">post_summ</a></span>(<span class="no">SIG_decomp</span>, <span class="st">"rho"</span>)[<span class="st">"50%"</span>,])</pre></body></html></div>
<pre><code>##           [,1]      [,2]
## [1,] 1.0000000 0.2685727
## [2,] 0.2685727 1.0000000</code></pre>
<p>When using <code><a href="../reference/vcov_decomp.html">vcov_decomp()</a></code>, you are recommended to always keep <code>check = TRUE</code>, which will ensure that the samples are from a valid variance-covariance matrix prior to performing the calculation. Setting <code>invert = TRUE</code> will take the inverse of the matrix from each posterior sample prior to performing the calculations (e.g., if you had monitored a precision matrix rather than a covariance matrix).</p>
</div>
</div>
<div id="manipulate-samples" class="section level1">
<h1 class="hasAnchor">
<a href="#manipulate-samples" class="anchor"></a>Manipulate Samples</h1>
<div id="post_thin" class="section level2">
<h2 class="hasAnchor">
<a href="#post_thin" class="anchor"></a><code>post_thin()</code>
</h2>
<p>If your downstream analyses of the posterior samples require many calculations, then it may be advantageous to develop the code with a smaller but otherwise identical version of the posterior output before unleashing them on the full output. You can thin the chains at quasi-evenly spaced intervals using <code><a href="../reference/post_thin.html">post_thin()</a></code>:</p>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="fu"><a href="../reference/post_thin.html">post_thin</a></span>(<span class="no">cjs</span>, <span class="kw">keep_percent</span> <span class="kw">=</span> <span class="fl">0.25</span>)</pre></body></html></div>
<p>Which would retain 25% of the samples from each chain, and return the result as an <code>mcmc.list</code> object. You may instead use the <code>keep_iters</code> argument to specify the number of iterations you wish to keep per chain.</p>
</div>
<div id="post_bind" class="section level2">
<h2 class="hasAnchor">
<a href="#post_bind" class="anchor"></a><code>post_bind()</code>
</h2>
<p>It may be desirable to combine posterior samples from the same MCMC run together in a single object. This case may arise when calculating derived quantities, and for organizational purposes you want to have them in one object as opposed to two. The two objects must have the same number of chains and saved iterations, and should be calculated from the same model run.</p>
<div id="two-mcmc-lists" class="section level3">
<h3 class="hasAnchor">
<a href="#two-mcmc-lists" class="anchor"></a>Two <code>mcmc.list</code>s</h3>
<p>The derived quantities stored in <code>SIG_decomp</code> from above are stored as an <code>mcmc.list</code> object and were calculated from the same model using consistent rules, so have the same dimensions. This makes it easy to use:</p>
<div class="sourceCode" id="cb46"><html><body><pre class="r"><span class="no">cjs</span> <span class="kw">=</span> <span class="fu"><a href="../reference/post_bind.html">post_bind</a></span>(<span class="kw">post1</span> <span class="kw">=</span> <span class="no">cjs</span>, <span class="kw">post2</span> <span class="kw">=</span> <span class="no">SIG_decomp</span>)</pre></body></html></div>
<p>and note that you have the new calculated nodes in you main object:</p>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="fu"><a href="../reference/get_params.html">get_params</a></span>(<span class="no">cjs</span>)</pre></body></html></div>
<pre><code>##  [1] "B0"     "sig_B0" "B1"     "sig_B1" "b0"     "b1"     "SIG"    "p"     
##  [9] "sigma"  "rho"</code></pre>
<p>You can now quickly verify that <code>"sig_B0"</code> and <code>"sig_B1"</code> are the same as <code>"sigma[1]"</code> and <code>"sigma[2]"</code>, respectively:</p>
<div class="sourceCode" id="cb49"><html><body><pre class="r"><span class="fu"><a href="../reference/post_summ.html">post_summ</a></span>(<span class="no">cjs</span>, <span class="st">"sig"</span>)</pre></body></html></div>
<pre><code>##          sig_B0      sig_B1  sigma[1]    sigma[2]
## mean  0.8440230 0.243479572 0.8440230 0.243479572
## sd    0.6187583 0.262166509 0.6187583 0.262166509
## 50%   0.6820298 0.178356796 0.6820298 0.178356796
## 2.5%  0.2766108 0.005735707 0.2766108 0.005735707
## 97.5% 2.4394721 0.820640886 2.4394721 0.820640886</code></pre>
</div>
<div id="one-mcmc-list-and-one-matrix" class="section level3">
<h3 class="hasAnchor">
<a href="#one-mcmc-list-and-one-matrix" class="anchor"></a>One <code>mcmc.list</code> and one <code>matrix</code>
</h3>
<p>Suppose instead that your derived quantities are stored as a matrix: iterations along the rows and quantities along the columns. Binding this to an <code>mcmc.list</code> object involves:</p>
<p>1.) Obtaining the matrix of the derived quantity(ies),</p>
<p>2.) Deciding on a name for each of your quantities, and</p>
<p>3.) Binding the derived list to the main list.</p>
<p>For step (1), generate such a matrix of derived quantities now, representing the inverse logit transformation of each of the <code>"b0"</code> elements:</p>
<div class="sourceCode" id="cb51"><html><body><pre class="r"><span class="co"># extract the raw samples from cjs in matrix form</span>
<span class="no">b0_samps</span> <span class="kw">=</span> <span class="fu"><a href="../reference/post_subset.html">post_subset</a></span>(<span class="no">cjs</span>, <span class="st">"b0"</span>, <span class="kw">matrix</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># perform a derived quantity calculation</span>
<span class="no">eb0_samps</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="no">b0_samps</span>)/(<span class="fl">1</span> + <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="no">b0_samps</span>))</pre></body></html></div>
<p>Now you have a derived quantity, so for step (2) change the names that each quantity will be stored as:</p>
<div class="sourceCode" id="cb52"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">eb0_samps</span>) <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"eb0["</span>, <span class="fl">1</span>:<span class="fl">5</span>, <span class="st">"]"</span>)</pre></body></html></div>
<p>Finally, for step (3) combine the samples using <code><a href="../reference/post_bind.html">post_bind()</a></code>:</p>
<div class="sourceCode" id="cb53"><html><body><pre class="r"><span class="no">cjs</span> <span class="kw">=</span> <span class="fu"><a href="../reference/post_bind.html">post_bind</a></span>(<span class="kw">post1</span> <span class="kw">=</span> <span class="no">cjs</span>, <span class="kw">post2</span> <span class="kw">=</span> <span class="no">eb0_samps</span>)</pre></body></html></div>
<p>If the two objects contain duplicate node names, the values from the object passed to the <code>post2</code> argument of <code><a href="../reference/post_bind.html">post_bind()</a></code> will have the suffix supplied under the argument <code>dup_id</code> (<code>"_p2"</code> by default), and a warning will be returned.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ben Staton.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
