<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multiple Models • postpack</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Multiple Models">
<meta property="og:description" content="postpack">
<meta property="og:image" content="https://raw.githubusercontent.com/bstaton1/postpack/add-sticker/man/figures/postpack-social-media-image.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@bstat0n">
<meta name="twitter:site" content="@bstat0n">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">postpack</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fas fa fas fa-book fa-lg"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-file fa-lg"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/feature-overview.html">Feature Overview</a>
    </li>
    <li>
      <a href="../articles/pattern-matching.html">Pattern Matching</a>
    </li>
    <li>
      <a href="../articles/multiple-models.html">Multiple Models</a>
    </li>
    <li>
      <a href="../articles/example-mcmclists.html">Example mcmc.lists</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">
    <span class="fas fa fas fa-newspaper fa-lg"></span>
     
    Changelog
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bstaton1/postpack/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="multiple-models_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Multiple Models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bstaton1/postpack/blob/master/vignettes/multiple-models.Rmd"><code>vignettes/multiple-models.Rmd</code></a></small>
      <div class="hidden name"><code>multiple-models.Rmd</code></div>

    </div>

    
    
<p>Rarely do we ever work with one model. Instead, you will typically want to evaluate how the posterior of a parameter changes with changes to data or model. It would be nice to scale up the functionality of ‘postpack’ to allow simple or complex post-processing tasks from posterior samples from similar models using the same consistent workflow. This vignette illustrates how this can be acheived using ‘postpack’.</p>
<blockquote>
<p>I have only recently began working with the ‘postpack’ functions in this regard efficiently, so the ideas are not fully fleshed out yet. In future versions of ‘postpack’, more functionality may be added in this regard.</p>
</blockquote>
<p>The most significant trick to use is to store multiple <code>mcmc.list</code> objects as elements of a larger <code>list</code> object. Suppose you have two <code>mcmc.list</code> objects from two highly similar models, named <code>cjs</code> and <code>cjs_no_rho</code> (see <code><a href="../articles/example-mcmclists.html">vignette("example-mcmclists")</a></code> or <code><a href="../reference/cjs.html">?cjs</a></code> for more details).</p>
<p>Load these objects into your session:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">postpack</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">cjs</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">cjs_no_rho</span>)</pre></body></html></div>
<p>And create a <code>list</code> object with them, where each element is an <code>mcmc.list</code> object:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">post_list</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">cjs</span>, <span class="no">cjs_no_rho</span>)</pre></body></html></div>
<p>Be sure to assign element names, which allows tracking which output is from which model later on:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">post_list</span>) <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"est_rho"</span>, <span class="st">"no_rho"</span>)</pre></body></html></div>
<p>From here, the world is wide open to you. Anything you would do with one <code>mcmc.list</code> object, you can do with two (or any number) through the use of the base R <code><a href="https://rdrr.io/r/base/apply.html">apply()</a></code> family of functions. For example, extract the dimensions of the saved output for each model:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">post_list</span>, <span class="no">post_dim</span>)</pre></body></html></div>
<pre><code>##           est_rho no_rho
## burn        11000  11000
## post_burn   50000  50000
## thin          200    200
## chains          2      2
## saved         500    500
## params         21     21</code></pre>
<p>Notice the two have identical dimensions. You can see that each model has the same parameters saved:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">post_list</span>, <span class="no">get_params</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"base_index"</span>)</pre></body></html></div>
<pre><code>##       est_rho    no_rho    
##  [1,] "B0"       "B0"      
##  [2,] "sig_B0"   "sig_B0"  
##  [3,] "B1"       "B1"      
##  [4,] "sig_B1"   "sig_B1"  
##  [5,] "b0[1]"    "b0[1]"   
##  [6,] "b0[2]"    "b0[2]"   
##  [7,] "b0[3]"    "b0[3]"   
##  [8,] "b0[4]"    "b0[4]"   
##  [9,] "b0[5]"    "b0[5]"   
## [10,] "b1[1]"    "b1[1]"   
## [11,] "b1[2]"    "b1[2]"   
## [12,] "b1[3]"    "b1[3]"   
## [13,] "b1[4]"    "b1[4]"   
## [14,] "b1[5]"    "b1[5]"   
## [15,] "SIG[1,1]" "SIG[1,1]"
## [16,] "SIG[2,1]" "SIG[2,1]"
## [17,] "SIG[1,2]" "SIG[1,2]"
## [18,] "SIG[2,2]" "SIG[2,2]"
## [19,] "p[2]"     "p[2]"    
## [20,] "p[3]"     "p[3]"    
## [21,] "p[4]"     "p[4]"</code></pre>
<p>You could verify that all parameters in both models converged well according to the <code>Rhat</code> statistic:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">post_list</span>, <span class="kw">function</span>(<span class="no">model</span>) <span class="fu"><a href="../reference/post_summ.html">post_summ</a></span>(<span class="no">model</span>, <span class="st">""</span>, <span class="kw">Rhat</span> <span class="kw">=</span> <span class="fl">TRUE</span>)[<span class="st">"Rhat"</span>,])</pre></body></html></div>
<pre><code>##          est_rho no_rho
## B0         1.011  1.020
## sig_B0     1.022  1.030
## B1         1.033  1.020
## sig_B1     1.043  1.010
## b0[1]      1.000  1.004
## b0[2]      0.998  0.998
## b0[3]      1.004  1.008
## b0[4]      0.999  1.002
## b0[5]      0.999  1.008
## b1[1]      1.005  0.999
## b1[2]      1.006  1.011
## b1[3]      1.007  1.009
## b1[4]      1.000  1.013
## b1[5]      1.017  0.999
## SIG[1,1]   1.182  1.141
## SIG[2,1]   1.009    NaN
## SIG[1,2]   1.009    NaN
## SIG[2,2]   1.199  1.074
## p[2]       1.000  1.000
## p[3]       0.999  1.004
## p[4]       1.005  1.003</code></pre>
<p>(The <code>NaN</code> values for <code>"SIG[1,2]"</code> and <code>"SIG[2,1]"</code> in the <code>no_rho</code> model are because those had the same value each MCMC iteration).</p>
<p>You could extract the summaries of the global survival coefficients from each model to see that the qualitative inference does not depend on the feature that differs between these two models:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">post_list</span>, <span class="kw">function</span>(<span class="no">model</span>) <span class="fu"><a href="../reference/post_summ.html">post_summ</a></span>(<span class="no">model</span>, <span class="st">"^B"</span>, <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">2</span>))</pre></body></html></div>
<pre><code>## $est_rho
##         B0   B1
## mean  1.59 0.42
## sd    0.49 0.21
## 50%   1.57 0.40
## 2.5%  0.55 0.06
## 97.5% 2.59 0.86
## 
## $no_rho
##         B0    B1
## mean  1.62  0.38
## sd    0.47  0.19
## 50%   1.60  0.39
## 2.5%  0.81 -0.02
## 97.5% 2.48  0.69</code></pre>
<p>Or verify that the detection probabilities are not affected either:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">post_list</span>, <span class="kw">function</span>(<span class="no">model</span>) <span class="fu"><a href="../reference/post_summ.html">post_summ</a></span>(<span class="no">model</span>, <span class="st">"p"</span>, <span class="kw">digits</span> <span class="kw">=</span> <span class="fl">2</span>))</pre></body></html></div>
<pre><code>## $est_rho
##       p[2] p[3] p[4]
## mean  0.74 0.70 0.63
## sd    0.02 0.03 0.04
## 50%   0.74 0.70 0.63
## 2.5%  0.69 0.64 0.55
## 97.5% 0.79 0.76 0.72
## 
## $no_rho
##       p[2] p[3] p[4]
## mean  0.74 0.70 0.64
## sd    0.03 0.03 0.05
## 50%   0.75 0.70 0.64
## 2.5%  0.69 0.64 0.56
## 97.5% 0.79 0.76 0.73</code></pre>
<p>You can embed more steps in the function that is applied to each <code>mcmc.list</code> object. For example, the code below obtains the posterior mean correlation matrix for each model:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">post_list</span>, <span class="kw">function</span>(<span class="no">model</span>) {
  <span class="no">SIG_decomp</span> <span class="kw">=</span> <span class="fu"><a href="../reference/vcov_decomp.html">vcov_decomp</a></span>(<span class="no">model</span>, <span class="st">"SIG"</span>)
  <span class="no">rho_mean</span> <span class="kw">=</span> <span class="fu"><a href="../reference/post_summ.html">post_summ</a></span>(<span class="no">SIG_decomp</span>, <span class="st">"rho"</span>)[<span class="st">"mean"</span>,]
  <span class="fu"><a href="../reference/array_format.html">array_format</a></span>(<span class="no">rho_mean</span>)
})</pre></body></html></div>
<pre><code>## $est_rho
##           [,1]      [,2]
## [1,] 1.0000000 0.1847515
## [2,] 0.1847515 1.0000000
## 
## $no_rho
##      [,1] [,2]
## [1,]    1    0
## [2,]    0    1</code></pre>
<p>Or more complex still, to predict the survival probability between two consecutive detection arrays for fish of different sizes in each year and model:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">post_list</span>, <span class="kw">function</span>(<span class="no">model</span>) {
  <span class="co"># 2SDs below average length, average length, and 2SDs above average length</span>
  <span class="co"># model was fitted with length scaled and centered</span>
  <span class="no">pred_length</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">2</span>,<span class="fl">0</span>,<span class="fl">2</span>)

  <span class="co"># extract posterior mean of random coefficients</span>
  <span class="no">b0_mean</span> <span class="kw">=</span> <span class="fu"><a href="../reference/post_summ.html">post_summ</a></span>(<span class="no">model</span>, <span class="st">"b0"</span>)[<span class="st">"mean"</span>,]
  <span class="no">b1_mean</span> <span class="kw">=</span> <span class="fu"><a href="../reference/post_summ.html">post_summ</a></span>(<span class="no">model</span>, <span class="st">"b1"</span>)[<span class="st">"mean"</span>,]

  <span class="co"># predict survival each year from coefficients at each length</span>
  <span class="no">pred_phi</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="fl">1</span>:<span class="fl">5</span>, <span class="kw">function</span>(<span class="no">y</span>) {
    <span class="no">logit_phi</span> <span class="kw">=</span> <span class="no">b0_mean</span>[<span class="no">y</span>] + <span class="no">b1_mean</span>[<span class="no">y</span>] * <span class="no">pred_length</span>
    <span class="no">phi</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="no">logit_phi</span>)/(<span class="fl">1</span> + <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="no">logit_phi</span>))
    <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">phi</span>, <span class="fl">2</span>)
  })

  <span class="co"># give dimension names</span>
  <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span>(<span class="no">pred_phi</span>) <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"small"</span>, <span class="st">"average"</span>, <span class="st">"large"</span>), <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"y"</span>, <span class="fl">1</span>:<span class="fl">5</span>))

  <span class="co"># return the predicted survival</span>
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">pred_phi</span>)
})</pre></body></html></div>
<pre><code>## $est_rho
##           y1   y2   y3   y4   y5
## small   0.66 0.81 0.67 0.70 0.60
## average 0.80 0.91 0.85 0.82 0.75
## large   0.89 0.96 0.94 0.90 0.86
## 
## $no_rho
##           y1   y2   y3   y4   y5
## small   0.66 0.83 0.66 0.70 0.59
## average 0.80 0.91 0.85 0.82 0.75
## large   0.89 0.96 0.95 0.89 0.86</code></pre>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ben Staton.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
